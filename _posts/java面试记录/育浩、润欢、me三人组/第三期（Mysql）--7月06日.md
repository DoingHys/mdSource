# 主题 ： mysql





# 问题集

**出题人：润欢**

**问题：**

## 1. 浏览器输入URL发生了什么? TCP和UDP区别? TCP如何保证传输可靠性?

   **浏览器输入URL发生了什么**：

   * 首先会通过DNS解析，获取到域名对应的IP
   * 然后通过三次握手建立TCP连接
   * 发送Http请求到服务器
   * 服务器处理请求并且返回Http报文
   * 浏览器解析渲染页面
   * 连接结束

   **TCP和UDP区别**：

   **UDP**：在传送数据之前不需要先建立连接，远地主机在收到 UDP 报文后，不需要给出任何确认，是不可靠的。虽然 UDP 不提供可靠交付，但在某些情况下 UDP 确是一种最有效的工作方式（一般用于即时通信），比如： QQ 语音、 QQ 视频 、直播等等

   **TCP**：提供的是面向连接，可靠的字节流服务。即客户和服务器交换数据前，必须现在双方之间建立一个TCP连接，之后才能传输数据。并且提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。

   **区别：**

   1. TCP是基于连接的，可靠的，UDP是无连接的，不可靠的
   2. TCP要求系统资源较多，UDP较少
   3. 两者的报文头不同，UDP报文头相对简单只占了8个字节，TCP报文头占了20个字节
   4. TCP传输效率较慢，UDP传输效率较快；一般要求通信速度用UDP,要求通信数据可靠用TCP

   

   **TCP如何保证传输可靠性**:

   首先TCP提供的是面向连接，可靠的字节流服务；它内部提供了一些列的方法来保障可靠性；

   这些方法分别是：**校验和，序列号，确认应答，超时重传，连接管理，流量控制，拥塞控制**。

   参考博客：https://blog.csdn.net/QEcode/article/details/90339162

   

## 2. 谈谈你在项目中使用了什么设计模式？

   常用的设计模式有，策略模式，构造器模式、单例模式、模板方法模式等；

   

## 3. 谈谈你对缓存雪崩、缓存穿透、缓存击穿的了解，以及如何解决？

   **参考博客：**

 https://www.jianshu.com/p/b880570a1545

https://blog.csdn.net/qq_17555933/article/details/106125186

   **缓存有效期：**一般情况下我们会给缓存的key设置有效时间，当key过期时，会被自动删除。

    设置有效期的作用如下：

   ​    1、提高系统吞吐量。

   ​    2、保持数据一致性的重要机制。

   ​    3、避免堆积冗余数据。

   **缓存雪崩：**

   描述： 缓存雪崩是因为缓存失效导致数据未加载到内存中，或者缓存时间大面积地失效，从而导致所有请求都会去查数据库，导致数据库、CPU和内存负载过高，甚至宕机。

   原因及解决方案：

   1. 缓存大面积失效

      解决：避免缓存设置相近的有效期；为有效期增加随机值；统一规划有效期，失效时间均匀分布。

   2. 对热点数据持续高并发

      解决方案：使用互斥锁：jvm锁机制；分布式锁机制。【如何解决】

   3. 有效期本身的缺陷

      解决方案：缓存永不过期，异步更新

      优点：不阻塞线程，用户体验好，不会出现雪崩效应；

      缺点：不保证一致性，代码复杂度增大（每个value值都要维护异步更新代码），容易堆积垃圾数据

   **双缓存方案**

   主缓存：有效期按照经验值设置，主要读取的缓存，主缓存失效后从数据库加载最新值；

   备份缓存：有效期长，获取锁失败时读取的缓存，主缓存更新时需要同步更新备份缓存。其实就是缓存降级策略。



​	 **缓存穿透**

​    描述：缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求，如发起为id为“-1”的数据或id为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大。

   解决方案：

1. 接口层增加校验，如用户鉴权校验，id做基础校验，id<=0的直接拦截；

2. 从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击

3. 对请求参数做校验，例如可以用正则；

4. 可以引入布隆过滤器，过滤一些异常的请求（将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被 这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。）。【具体描述一下】

   

   **缓存击穿**

   描述：缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力，缓存击穿和缓存雪崩的区别是，前者针对部分热点key，后者针对大面积的key

   参考博客：https://www.jianshu.com/p/5f8501447de2

   解决方案：

   1. 使用互斥锁

   2. 检查更新缓存，多设置一个有效时间，如果小于系统一分钟 ，主动更新缓存

   3. 分级缓存

      用 L1 (一级缓存)和 L2(二级缓存) 缓存方式，L1 缓存失效时间短，L2 缓存失效时间长。 请求优先从 L1 缓存获取数据，如果 L1缓存未命中则加锁，只有 1 个线程获取到锁,这个线程再从数据库中读取数据并将数据再更新到到 L1 缓存和 L2 缓存中，而其他线程依旧从 L2 缓存获取数据并返回。

   个人提问：对于缓存雪崩和缓存击穿的解决方案其实可以共用？


4. jdk动态代理与cglib实现的区别？

   代理模式：https://blog.csdn.net/yhl_jxy/article/details/52679882；

   JDK动态代理基于拦截器和反射来实现。

   JDK代理是不需要第三方库支持的，只需要JDK环境就可以进行代理，使用条件：

   1）必须实现InvocationHandler接口；

   2）使用Proxy.newProxyInstance产生代理对象；

   3）被代理的对象必须要实现接口；

   

   使用JDK动态代理的五大步骤：

   1）通过实现InvocationHandler接口来自定义自己的InvocationHandler；

   2）通过Proxy.getProxyClass获得动态代理类；

   3）通过反射机制获得代理类的构造方法，方法签名为getConstructor(InvocationHandler.class)；

   4）通过构造函数获得代理对象并将自定义的InvocationHandler实例对象传为参数传入；

   5）通过代理对象调用目标方法；

   

   区别：

   jdk只能针对接口不能针对类实现代理。

   CGLib通过继承方式实现代理。所以类或方法最好不要声明成final，对于final类或方法，是无法继承的。

   

   Spring如何选择用JDK还是CGLiB？

   1）当Bean实现接口时，Spring就会用JDK的动态代理。

   2）当Bean没有实现接口时，Spring使用CGlib是实现。

   3）可以强制使用CGlib（在spring配置中加入<aop:aspectj-autoproxy proxy-target-class="true"/>）。

5. 谈谈你对时间滑动窗口算法的理解



# 育浩

**公开问题：**

谈谈你对缓存雪崩、缓存穿透、缓存击穿的了解，以及如何解决？

项目中用过什么设计模式（1）

模板模式：

爬虫方式，业务逻辑类似，两种接口提供一个接口；

适配器模式、策略模式

**主题问题:**

MyISAM与InnoDb的区别以及各自适合的场景？

没有事务的数据库、有大量查询、

说一下项目中遇到的sql优化问题，如何解决的？

**历史问题:**

说一下ReentrantLock？



# 润欢

**公开问题：**

jdk动态代理与cglib实现的区别？

**主题问题:**

事务隔离级别以及各级别下的并发访问问题？

InnoDB可重复读隔离级别下如何避免幻读？

**历史问题**:

谈谈对AQS的理解？



# 永生

1. 回表、索引覆盖、索引失效？
2. ThreadLocal的理解？
3. 设计模式？(回答不清楚)



# 问题整合

1. 谈谈你在项目中使用了什么设计模式？
2. 数据库事务隔离性隔离级别
3. ThreadLocal的理解
4. 密集索引与稀疏索引
5. MyISAM与InnoDb的区别以及各自适合的场景？
6. 说一下项目中遇到的sql优化问题，如何解决的？
7. 滑动窗口的理解
8. 索引判断，如何判断。
9. happends-before原则
10. 浏览器输入URL发生了什么? TCP和UDP区别? TCP如何保证传输可靠性?
11. 谈谈你对缓存雪崩、缓存穿透、缓存击穿的了解，以及如何解决？
12. jdk动态代理与cglib实现的区别？
13. 谈谈你对mysql回表（索引覆盖）的理解？
14. 谈谈索引失效的情况？
15. 事务隔离级别以及各级别下的并发访问问题？